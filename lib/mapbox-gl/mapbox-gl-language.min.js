function MapboxLanguage(a){if(a=Object.assign({},a),!(this instanceof MapboxLanguage))throw new Error('MapboxLanguage needs to be called with the new keyword');this.setLanguage=this.setLanguage.bind(this),this._initialStyleUpdate=this._initialStyleUpdate.bind(this),this._defaultLanguage=a.defaultLanguage,this._isLanguageField=a.languageField||/^name_/,this._getLanguageField=a.getLanguageField||function(a){return a==='mul'?'name':`name_${a}`},this._languageSource=a.languageSource||null,this._languageTransform=a.languageTransform,this._excludedLayerIds=a.excludedLayerIds||[],this.supportedLanguages=a.supportedLanguages||['ar','de','en','es','fr','it','ja','ko','mul','pt','ru','vi','zh-Hans','zh-Hant']}const isTokenField=/^\{name/;function isFlatExpressionField(c,a){const b=Array.isArray(a)&&a[0]==='get';return b&&isTokenField.test(a[1])&&console.warn('This plugin no longer supports the use of token syntax (e.g. {name}). Please use a get expression. See https://docs.mapbox.com/mapbox-gl-js/style-spec/expressions/ for more details.'),b&&c.test(a[1])}function adaptNestedExpressionField(b,a,c){if(Array.isArray(a))for(let d=1;d<a.length;d++)Array.isArray(a[d])&&(isFlatExpressionField(b,a[d])&&(a[d][1]=c),adaptNestedExpressionField(b,a[d],c))}function adaptPropertyLanguage(c,a,b){if(isFlatExpressionField(c,a)&&(a[1]=b),adaptNestedExpressionField(c,a,b),a[0]==='get'&&a[1]==='name'){const c=a.slice(),d=['get',b];a=['coalesce',d,c]}return a}function changeLayerTextProperty(b,a,c,d){return a.layout&&a.layout['text-field']&&d.indexOf(a.id)===-1?Object.assign({},a,{layout:Object.assign({},a.layout,{'text-field':adaptPropertyLanguage(b,a.layout['text-field'],c)})}):a}function findStreetsSource(a){const b=Object.keys(a.sources).filter(c=>{const b=a.sources[c].url;return b&&b.indexOf('mapbox.mapbox-streets-v8')>-1||/mapbox-streets-v[1-9][1-9]/.test(b)});if(!b.length)throw new Error('If using MapboxLanguage with a Mapbox style, the style must be based on vector tile version 8, e.g. "streets-v11"');return b[0]}MapboxLanguage.prototype.setLanguage=function(a,b){if(this.supportedLanguages.indexOf(b)<0)throw new Error(`Language ${b} is not supported`);const c=this._languageSource||findStreetsSource(a);if(!c)return a;const e=this._getLanguageField(b),f=this._isLanguageField,g=this._excludedLayerIds,h=a.layers.map(a=>a.source===c?changeLayerTextProperty(f,a,e,g):a),d=Object.assign({},a,{layers:h});return this._languageTransform?this._languageTransform(d,b):d},MapboxLanguage.prototype._initialStyleUpdate=function(){const a=this._map.getStyle(),b=this._defaultLanguage||browserLanguage(this.supportedLanguages);this._map.setStyle(this.setLanguage(a,b))};function browserLanguage(d){const a=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,c=a&&a.split('-');let b=a;return c.length>1&&(b=c[0]),d.indexOf(b)>-1?b:null}MapboxLanguage.prototype.onAdd=function(a){return this._map=a,this._map.on('style.load',this._initialStyleUpdate),this._container=document.createElement('div'),this._container},MapboxLanguage.prototype.onRemove=function(){this._map.off('style.load',this._initialStyleUpdate),this._map=void 0},typeof module!='undefined'&&typeof module.exports!='undefined'?module.exports=MapboxLanguage:window.MapboxLanguage=MapboxLanguage